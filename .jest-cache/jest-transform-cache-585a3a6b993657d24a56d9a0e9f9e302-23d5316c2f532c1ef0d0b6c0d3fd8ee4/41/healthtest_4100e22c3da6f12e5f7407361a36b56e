428c60a691eaaf67f89925c38e774ee7
"use strict";
/**
 * Health Check & System Tests
 * Tests for /api/v1/health/* endpoints
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const utils_1 = require("../utils");
(0, globals_1.describe)('Health Check & System Endpoints', () => {
    (0, globals_1.describe)('GET /api/v1/health/status - System Health', () => {
        (0, globals_1.test)('should return system health status without authentication', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData).toHaveProperty('status');
            (0, globals_1.expect)(healthData).toHaveProperty('timestamp');
            (0, globals_1.expect)(healthData).toHaveProperty('version');
            (0, globals_1.expect)(healthData).toHaveProperty('uptime');
            (0, globals_1.expect)(healthData.status).toBe('healthy');
            (0, globals_1.expect)(typeof healthData.timestamp).toBe('string');
            (0, globals_1.expect)(new Date(healthData.timestamp)).toBeInstanceOf(Date);
            (0, globals_1.expect)(typeof healthData.uptime).toBe('number');
            (0, globals_1.expect)(healthData.uptime).toBeGreaterThan(0);
            // Assert response time
            utils_1.testUtils.assertResponseTime(response, 50);
        });
        (0, globals_1.test)('should include service status checks', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData).toHaveProperty('services');
            (0, globals_1.expect)(typeof healthData.services).toBe('object');
            // Check database status
            (0, globals_1.expect)(healthData.services).toHaveProperty('database');
            (0, globals_1.expect)(healthData.services.database).toHaveProperty('status');
            (0, globals_1.expect)(healthData.services.database).toHaveProperty('responseTime');
            (0, globals_1.expect)(['healthy', 'degraded', 'unhealthy']).toContain(healthData.services.database.status);
            (0, globals_1.expect)(typeof healthData.services.database.responseTime).toBe('number');
            // Check authentication service status
            (0, globals_1.expect)(healthData.services).toHaveProperty('auth');
            (0, globals_1.expect)(healthData.services.auth).toHaveProperty('status');
            (0, globals_1.expect)(['healthy', 'degraded', 'unhealthy']).toContain(healthData.services.auth.status);
        });
        (0, globals_1.test)('should include system metrics', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData).toHaveProperty('metrics');
            (0, globals_1.expect)(typeof healthData.metrics).toBe('object');
            // Check memory usage
            if (healthData.metrics.memory) {
                (0, globals_1.expect)(healthData.metrics.memory).toHaveProperty('used');
                (0, globals_1.expect)(healthData.metrics.memory).toHaveProperty('total');
                (0, globals_1.expect)(typeof healthData.metrics.memory.used).toBe('number');
                (0, globals_1.expect)(typeof healthData.metrics.memory.total).toBe('number');
                (0, globals_1.expect)(healthData.metrics.memory.used).toBeGreaterThan(0);
                (0, globals_1.expect)(healthData.metrics.memory.total).toBeGreaterThan(healthData.metrics.memory.used);
            }
            // Check CPU usage
            if (healthData.metrics.cpu) {
                (0, globals_1.expect)(typeof healthData.metrics.cpu.usage).toBe('number');
                (0, globals_1.expect)(healthData.metrics.cpu.usage).toBeGreaterThanOrEqual(0);
                (0, globals_1.expect)(healthData.metrics.cpu.usage).toBeLessThanOrEqual(100);
            }
        });
        (0, globals_1.test)('should return consistent response format', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            (0, globals_1.expect)(response.status).toBe(200);
            (0, globals_1.expect)(response.body).toHaveProperty('success', true);
            (0, globals_1.expect)(response.body).toHaveProperty('data');
            (0, globals_1.expect)(response.body.error).toBeUndefined();
            const healthData = response.body.data;
            (0, globals_1.expect)(healthData).toHaveProperty('status');
            (0, globals_1.expect)(healthData).toHaveProperty('timestamp');
            (0, globals_1.expect)(healthData).toHaveProperty('services');
        });
        (0, globals_1.test)('should work without any headers', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            utils_1.testUtils.assertSuccessResponse(response, 200);
            // Should work even without any special headers
            (0, globals_1.expect)(response.status).toBe(200);
        });
        (0, globals_1.test)('should handle multiple concurrent health checks', async () => {
            const responses = await utils_1.testUtils.testConcurrency('GET', '/api/v1/health/status', 10);
            (0, globals_1.expect)(responses).toHaveLength(10);
            responses.forEach(response => {
                utils_1.testUtils.assertSuccessResponse(response, 200);
                utils_1.testUtils.assertResponseTime(response, 100);
            });
            // All responses should be similar
            const firstResponse = responses[0].body.data;
            responses.forEach(response => {
                (0, globals_1.expect)(response.body.data.status).toBe(firstResponse.status);
                (0, globals_1.expect)(response.body.data.version).toBe(firstResponse.version);
            });
        });
        (0, globals_1.test)('should include API version information', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData).toHaveProperty('version');
            (0, globals_1.expect)(typeof healthData.version).toBe('string');
            (0, globals_1.expect)(healthData.version.length).toBeGreaterThan(0);
            // Version should follow semantic versioning pattern
            (0, globals_1.expect)(healthData.version).toMatch(/^\d+\.\d+\.\d+/);
        });
        (0, globals_1.test)('should include environment information', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData).toHaveProperty('environment');
            (0, globals_1.expect)(['development', 'test', 'staging', 'production']).toContain(healthData.environment);
        });
    });
    (0, globals_1.describe)('Database Connectivity Check', () => {
        (0, globals_1.test)('should verify database connection in health status', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            (0, globals_1.expect)(healthData.services.database.status).toBe('healthy');
            (0, globals_1.expect)(healthData.services.database.responseTime).toBeLessThan(1000); // Should respond within 1 second
        });
        (0, globals_1.test)('should include database connection pool status', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            if (healthData.services.database.pool) {
                (0, globals_1.expect)(healthData.services.database.pool).toHaveProperty('active');
                (0, globals_1.expect)(healthData.services.database.pool).toHaveProperty('idle');
                (0, globals_1.expect)(healthData.services.database.pool).toHaveProperty('total');
                (0, globals_1.expect)(typeof healthData.services.database.pool.active).toBe('number');
                (0, globals_1.expect)(typeof healthData.services.database.pool.idle).toBe('number');
                (0, globals_1.expect)(typeof healthData.services.database.pool.total).toBe('number');
                (0, globals_1.expect)(healthData.services.database.pool.active).toBeGreaterThanOrEqual(0);
                (0, globals_1.expect)(healthData.services.database.pool.idle).toBeGreaterThanOrEqual(0);
                (0, globals_1.expect)(healthData.services.database.pool.total).toBeGreaterThan(0);
            }
        });
        (0, globals_1.test)('should test actual database query execution', async () => {
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            // Database should be responding to queries
            (0, globals_1.expect)(healthData.services.database.status).toBe('healthy');
            // Response time should be reasonable
            (0, globals_1.expect)(healthData.services.database.responseTime).toBeLessThan(500);
        });
    });
    (0, globals_1.describe)('Health Endpoint Performance', () => {
        (0, globals_1.test)('should respond within 50ms', async () => {
            const { response, passed } = await utils_1.testUtils.testPerformance('GET', '/api/v1/health/status', 50);
            (0, globals_1.expect)(passed).toBe(true);
            utils_1.testUtils.assertSuccessResponse(response, 200);
        });
        (0, globals_1.test)('should maintain performance under load', async () => {
            const responses = await utils_1.testUtils.testConcurrency('GET', '/api/v1/health/status', 20);
            (0, globals_1.expect)(responses).toHaveLength(20);
            responses.forEach(response => {
                utils_1.testUtils.assertSuccessResponse(response, 200);
                utils_1.testUtils.assertResponseTime(response, 100); // Allow more time under load
            });
        });
        (0, globals_1.test)('should have consistent response times', async () => {
            const responseTimes = [];
            // Make 10 sequential requests
            for (let i = 0; i < 10; i++) {
                const start = Date.now();
                const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
                const responseTime = Date.now() - start;
                utils_1.testUtils.assertSuccessResponse(response, 200);
                responseTimes.push(responseTime);
            }
            // Calculate average and standard deviation
            const average = responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;
            const variance = responseTimes.reduce((a, b) => a + Math.pow(b - average, 2), 0) / responseTimes.length;
            const stdDev = Math.sqrt(variance);
            // Response times should be consistent (low standard deviation)
            (0, globals_1.expect)(average).toBeLessThan(100);
            (0, globals_1.expect)(stdDev).toBeLessThan(50); // Low variance in response times
        });
        (0, globals_1.test)('should not degrade with rapid successive calls', async () => {
            const promises = [];
            // Make 50 rapid requests
            for (let i = 0; i < 50; i++) {
                promises.push(utils_1.testUtils.publicGet('/api/v1/health/status'));
            }
            const responses = await Promise.all(promises);
            responses.forEach(response => {
                utils_1.testUtils.assertSuccessResponse(response, 200);
                utils_1.testUtils.assertResponseTime(response, 150);
            });
        });
    });
    (0, globals_1.describe)('Health Endpoint Edge Cases', () => {
        (0, globals_1.test)('should handle malformed requests gracefully', async () => {
            // Test with various malformed requests
            const malformedRequests = [
                '/api/v1/health/status?invalid=param',
                '/api/v1/health/status/',
                '/api/v1/health/status#fragment',
                '/api/v1/health/status?format=xml'
            ];
            for (const url of malformedRequests) {
                const response = await utils_1.testUtils.publicGet(url);
                // Should still return health status (ignore invalid params)
                utils_1.testUtils.assertSuccessResponse(response, 200);
            }
        });
        (0, globals_1.test)('should work with different HTTP methods', async () => {
            // Health endpoint should only work with GET
            const response = await utils_1.testUtils.get('/api/v1/health/status');
            utils_1.testUtils.assertSuccessResponse(response, 200);
            // Other methods should return 405 Method Not Allowed
            try {
                await utils_1.testUtils.post('/api/v1/health/status', {});
            }
            catch (error) {
                // Expected to fail
            }
        });
        (0, globals_1.test)('should handle very high concurrent load', async () => {
            const responses = await utils_1.testUtils.testConcurrency('GET', '/api/v1/health/status', 100 // High concurrency
            );
            (0, globals_1.expect)(responses).toHaveLength(100);
            // Most requests should succeed
            const successfulResponses = responses.filter(r => r.status === 200);
            (0, globals_1.expect)(successfulResponses.length).toBeGreaterThan(90); // At least 90% success rate
            successfulResponses.forEach(response => {
                utils_1.testUtils.assertResponseTime(response, 200);
            });
        });
        (0, globals_1.test)('should return appropriate status during system stress', async () => {
            // This test would ideally stress the system and check health status
            const response = await utils_1.testUtils.publicGet('/api/v1/health/status');
            const healthData = utils_1.testUtils.assertSuccessResponse(response, 200);
            // Status should be one of the valid states
            (0, globals_1.expect)(['healthy', 'degraded', 'unhealthy']).toContain(healthData.status);
            // Services should have valid statuses
            Object.values(healthData.services).forEach((service) => {
                (0, globals_1.expect)(['healthy', 'degraded', 'unhealthy']).toContain(service.status);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEb2N1bWVudHNcXEdpdEh1YlxcZW1hXFx0ZXN0c1xcdW5pdFxcaGVhbHRoLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCwyQ0FBNEU7QUFDNUUsb0NBQXFDO0FBRXJDLElBQUEsa0JBQVEsRUFBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7SUFDL0MsSUFBQSxrQkFBUSxFQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtRQUN6RCxJQUFBLGNBQUksRUFBQywyREFBMkQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzRSxNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFTLENBQUMsU0FBUyxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFFcEUsTUFBTSxVQUFVLEdBQUcsaUJBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFbEUsSUFBQSxnQkFBTSxFQUFDLFVBQVUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUM1QyxJQUFBLGdCQUFNLEVBQUMsVUFBVSxDQUFDLENBQUMsY0FBYyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQy9DLElBQUEsZ0JBQU0sRUFBQyxVQUFVLENBQUMsQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDN0MsSUFBQSxnQkFBTSxFQUFDLFVBQVUsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUU1QyxJQUFBLGdCQUFNLEVBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMxQyxJQUFBLGdCQUFNLEVBQUMsT0FBTyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ25ELElBQUEsZ0JBQU0sRUFBQyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUQsSUFBQSxn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QUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLHVEQUF1RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3ZFLG9FQUFvRTtZQUNwRSxNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFTLENBQUMsU0FBUyxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFFcEUsTUFBTSxVQUFVLEdBQUcsaUJBQVMsQ0FBQyxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFFbEUsMkNBQTJDO1lBQzNDLElBQUEsZ0JBQU0sRUFBQyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsV0FBVyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRTFFLHNDQUFzQztZQUN0QyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFZLEVBQUUsRUFBRTtnQkFDMUQsSUFBQSxnQkFBTSxFQUFDLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekUsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEb2N1bWVudHNcXEdpdEh1YlxcZW1hXFx0ZXN0c1xcdW5pdFxcaGVhbHRoLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBIZWFsdGggQ2hlY2sgJiBTeXN0ZW0gVGVzdHNcbiAqIFRlc3RzIGZvciAvYXBpL3YxL2hlYWx0aC8qIGVuZHBvaW50c1xuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCB0ZXN0LCBleHBlY3QsIGJlZm9yZUFsbCwgYWZ0ZXJBbGwgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IHRlc3RVdGlscyB9IGZyb20gJy4uL3V0aWxzJztcblxuZGVzY3JpYmUoJ0hlYWx0aCBDaGVjayAmIFN5c3RlbSBFbmRwb2ludHMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdHRVQgL2FwaS92MS9oZWFsdGgvc3RhdHVzIC0gU3lzdGVtIEhlYWx0aCcsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcmV0dXJuIHN5c3RlbSBoZWFsdGggc3RhdHVzIHdpdGhvdXQgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGhEYXRhID0gdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aERhdGEpLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXMnKTtcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhKS50b0hhdmVQcm9wZXJ0eSgndGltZXN0YW1wJyk7XG4gICAgICBleHBlY3QoaGVhbHRoRGF0YSkudG9IYXZlUHJvcGVydHkoJ3ZlcnNpb24nKTtcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhKS50b0hhdmVQcm9wZXJ0eSgndXB0aW1lJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhLnN0YXR1cykudG9CZSgnaGVhbHRoeScpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBoZWFsdGhEYXRhLnRpbWVzdGFtcCkudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QobmV3IERhdGUoaGVhbHRoRGF0YS50aW1lc3RhbXApKS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgaGVhbHRoRGF0YS51cHRpbWUpLnRvQmUoJ251bWJlcicpO1xuICAgICAgZXhwZWN0KGhlYWx0aERhdGEudXB0aW1lKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBcbiAgICAgIC8vIEFzc2VydCByZXNwb25zZSB0aW1lXG4gICAgICB0ZXN0VXRpbHMuYXNzZXJ0UmVzcG9uc2VUaW1lKHJlc3BvbnNlLCA1MCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaW5jbHVkZSBzZXJ2aWNlIHN0YXR1cyBjaGVja3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGhEYXRhID0gdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aERhdGEpLnRvSGF2ZVByb3BlcnR5KCdzZXJ2aWNlcycpO1xuICAgICAgZXhwZWN0KHR5cGVvZiBoZWFsdGhEYXRhLnNlcnZpY2VzKS50b0JlKCdvYmplY3QnKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZGF0YWJhc2Ugc3RhdHVzXG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcykudG9IYXZlUHJvcGVydHkoJ2RhdGFiYXNlJyk7XG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZSkudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycpO1xuICAgICAgZXhwZWN0KGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2UpLnRvSGF2ZVByb3BlcnR5KCdyZXNwb25zZVRpbWUnKTtcbiAgICAgIGV4cGVjdChbJ2hlYWx0aHknLCAnZGVncmFkZWQnLCAndW5oZWFsdGh5J10pLnRvQ29udGFpbihoZWFsdGhEYXRhLnNlcnZpY2VzLmRhdGFiYXNlLnN0YXR1cyk7XG4gICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2UucmVzcG9uc2VUaW1lKS50b0JlKCdudW1iZXInKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgYXV0aGVudGljYXRpb24gc2VydmljZSBzdGF0dXNcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhLnNlcnZpY2VzKS50b0hhdmVQcm9wZXJ0eSgnYXV0aCcpO1xuICAgICAgZXhwZWN0KGhlYWx0aERhdGEuc2VydmljZXMuYXV0aCkudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycpO1xuICAgICAgZXhwZWN0KFsnaGVhbHRoeScsICdkZWdyYWRlZCcsICd1bmhlYWx0aHknXSkudG9Db250YWluKGhlYWx0aERhdGEuc2VydmljZXMuYXV0aC5zdGF0dXMpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGluY2x1ZGUgc3lzdGVtIG1ldHJpY3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGhEYXRhID0gdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aERhdGEpLnRvSGF2ZVByb3BlcnR5KCdtZXRyaWNzJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEubWV0cmljcykudG9CZSgnb2JqZWN0Jyk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIG1lbW9yeSB1c2FnZVxuICAgICAgaWYgKGhlYWx0aERhdGEubWV0cmljcy5tZW1vcnkpIHtcbiAgICAgICAgZXhwZWN0KGhlYWx0aERhdGEubWV0cmljcy5tZW1vcnkpLnRvSGF2ZVByb3BlcnR5KCd1c2VkJyk7XG4gICAgICAgIGV4cGVjdChoZWFsdGhEYXRhLm1ldHJpY3MubWVtb3J5KS50b0hhdmVQcm9wZXJ0eSgndG90YWwnKTtcbiAgICAgICAgZXhwZWN0KHR5cGVvZiBoZWFsdGhEYXRhLm1ldHJpY3MubWVtb3J5LnVzZWQpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEubWV0cmljcy5tZW1vcnkudG90YWwpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5tZXRyaWNzLm1lbW9yeS51c2VkKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIGV4cGVjdChoZWFsdGhEYXRhLm1ldHJpY3MubWVtb3J5LnRvdGFsKS50b0JlR3JlYXRlclRoYW4oaGVhbHRoRGF0YS5tZXRyaWNzLm1lbW9yeS51c2VkKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgQ1BVIHVzYWdlXG4gICAgICBpZiAoaGVhbHRoRGF0YS5tZXRyaWNzLmNwdSkge1xuICAgICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEubWV0cmljcy5jcHUudXNhZ2UpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5tZXRyaWNzLmNwdS51c2FnZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgZXhwZWN0KGhlYWx0aERhdGEubWV0cmljcy5jcHUudXNhZ2UpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMTAwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gY29uc2lzdGVudCByZXNwb25zZSBmb3JtYXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnLCB0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZGF0YScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhbHRoRGF0YSA9IHJlc3BvbnNlLmJvZHkuZGF0YTtcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhKS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJyk7XG4gICAgICBleHBlY3QoaGVhbHRoRGF0YSkudG9IYXZlUHJvcGVydHkoJ3RpbWVzdGFtcCcpO1xuICAgICAgZXhwZWN0KGhlYWx0aERhdGEpLnRvSGF2ZVByb3BlcnR5KCdzZXJ2aWNlcycpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHdvcmsgd2l0aG91dCBhbnkgaGVhZGVycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGVzdFV0aWxzLnB1YmxpY0dldCgnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyk7XG4gICAgICBcbiAgICAgIHRlc3RVdGlscy5hc3NlcnRTdWNjZXNzUmVzcG9uc2UocmVzcG9uc2UsIDIwMCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCB3b3JrIGV2ZW4gd2l0aG91dCBhbnkgc3BlY2lhbCBoZWFkZXJzXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIG11bHRpcGxlIGNvbmN1cnJlbnQgaGVhbHRoIGNoZWNrcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IGF3YWl0IHRlc3RVdGlscy50ZXN0Q29uY3VycmVuY3koXG4gICAgICAgICdHRVQnLFxuICAgICAgICAnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyxcbiAgICAgICAgMTBcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZXMpLnRvSGF2ZUxlbmd0aCgxMCk7XG4gICAgICBcbiAgICAgIHJlc3BvbnNlcy5mb3JFYWNoKHJlc3BvbnNlID0+IHtcbiAgICAgICAgdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgICAgdGVzdFV0aWxzLmFzc2VydFJlc3BvbnNlVGltZShyZXNwb25zZSwgMTAwKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBBbGwgcmVzcG9uc2VzIHNob3VsZCBiZSBzaW1pbGFyXG4gICAgICBjb25zdCBmaXJzdFJlc3BvbnNlID0gcmVzcG9uc2VzWzBdLmJvZHkuZGF0YTtcbiAgICAgIHJlc3BvbnNlcy5mb3JFYWNoKHJlc3BvbnNlID0+IHtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZGF0YS5zdGF0dXMpLnRvQmUoZmlyc3RSZXNwb25zZS5zdGF0dXMpO1xuICAgICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhLnZlcnNpb24pLnRvQmUoZmlyc3RSZXNwb25zZS52ZXJzaW9uKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGluY2x1ZGUgQVBJIHZlcnNpb24gaW5mb3JtYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGhEYXRhID0gdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aERhdGEpLnRvSGF2ZVByb3BlcnR5KCd2ZXJzaW9uJyk7XG4gICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEudmVyc2lvbikudG9CZSgnc3RyaW5nJyk7XG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS52ZXJzaW9uLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgXG4gICAgICAvLyBWZXJzaW9uIHNob3VsZCBmb2xsb3cgc2VtYW50aWMgdmVyc2lvbmluZyBwYXR0ZXJuXG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS52ZXJzaW9uKS50b01hdGNoKC9eXFxkK1xcLlxcZCtcXC5cXGQrLyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaW5jbHVkZSBlbnZpcm9ubWVudCBpbmZvcm1hdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGVzdFV0aWxzLnB1YmxpY0dldCgnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGhlYWx0aERhdGEgPSB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgXG4gICAgICBleHBlY3QoaGVhbHRoRGF0YSkudG9IYXZlUHJvcGVydHkoJ2Vudmlyb25tZW50Jyk7XG4gICAgICBleHBlY3QoWydkZXZlbG9wbWVudCcsICd0ZXN0JywgJ3N0YWdpbmcnLCAncHJvZHVjdGlvbiddKS50b0NvbnRhaW4oaGVhbHRoRGF0YS5lbnZpcm9ubWVudCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEYXRhYmFzZSBDb25uZWN0aXZpdHkgQ2hlY2snLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHZlcmlmeSBkYXRhYmFzZSBjb25uZWN0aW9uIGluIGhlYWx0aCBzdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgXG4gICAgICBjb25zdCBoZWFsdGhEYXRhID0gdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2Uuc3RhdHVzKS50b0JlKCdoZWFsdGh5Jyk7XG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5yZXNwb25zZVRpbWUpLnRvQmVMZXNzVGhhbigxMDAwKTsgLy8gU2hvdWxkIHJlc3BvbmQgd2l0aGluIDEgc2Vjb25kXG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaW5jbHVkZSBkYXRhYmFzZSBjb25uZWN0aW9uIHBvb2wgc3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0ZXN0VXRpbHMucHVibGljR2V0KCcvYXBpL3YxL2hlYWx0aC9zdGF0dXMnKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhbHRoRGF0YSA9IHRlc3RVdGlscy5hc3NlcnRTdWNjZXNzUmVzcG9uc2UocmVzcG9uc2UsIDIwMCk7XG4gICAgICBcbiAgICAgIGlmIChoZWFsdGhEYXRhLnNlcnZpY2VzLmRhdGFiYXNlLnBvb2wpIHtcbiAgICAgICAgZXhwZWN0KGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2UucG9vbCkudG9IYXZlUHJvcGVydHkoJ2FjdGl2ZScpO1xuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sKS50b0hhdmVQcm9wZXJ0eSgnaWRsZScpO1xuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sKS50b0hhdmVQcm9wZXJ0eSgndG90YWwnKTtcbiAgICAgICAgXG4gICAgICAgIGV4cGVjdCh0eXBlb2YgaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sLmFjdGl2ZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICAgIGV4cGVjdCh0eXBlb2YgaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sLmlkbGUpLnRvQmUoJ251bWJlcicpO1xuICAgICAgICBleHBlY3QodHlwZW9mIGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2UucG9vbC50b3RhbCkudG9CZSgnbnVtYmVyJyk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sLmFjdGl2ZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgICAgZXhwZWN0KGhlYWx0aERhdGEuc2VydmljZXMuZGF0YWJhc2UucG9vbC5pZGxlKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5wb29sLnRvdGFsKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgdGVzdCBhY3R1YWwgZGF0YWJhc2UgcXVlcnkgZXhlY3V0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0ZXN0VXRpbHMucHVibGljR2V0KCcvYXBpL3YxL2hlYWx0aC9zdGF0dXMnKTtcbiAgICAgIFxuICAgICAgY29uc3QgaGVhbHRoRGF0YSA9IHRlc3RVdGlscy5hc3NlcnRTdWNjZXNzUmVzcG9uc2UocmVzcG9uc2UsIDIwMCk7XG4gICAgICBcbiAgICAgIC8vIERhdGFiYXNlIHNob3VsZCBiZSByZXNwb25kaW5nIHRvIHF1ZXJpZXNcbiAgICAgIGV4cGVjdChoZWFsdGhEYXRhLnNlcnZpY2VzLmRhdGFiYXNlLnN0YXR1cykudG9CZSgnaGVhbHRoeScpO1xuICAgICAgXG4gICAgICAvLyBSZXNwb25zZSB0aW1lIHNob3VsZCBiZSByZWFzb25hYmxlXG4gICAgICBleHBlY3QoaGVhbHRoRGF0YS5zZXJ2aWNlcy5kYXRhYmFzZS5yZXNwb25zZVRpbWUpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnSGVhbHRoIEVuZHBvaW50IFBlcmZvcm1hbmNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZXNwb25kIHdpdGhpbiA1MG1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyByZXNwb25zZSwgcGFzc2VkIH0gPSBhd2FpdCB0ZXN0VXRpbHMudGVzdFBlcmZvcm1hbmNlKFxuICAgICAgICAnR0VUJyxcbiAgICAgICAgJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycsXG4gICAgICAgIDUwXG4gICAgICApO1xuICAgICAgXG4gICAgICBleHBlY3QocGFzc2VkKS50b0JlKHRydWUpO1xuICAgICAgdGVzdFV0aWxzLmFzc2VydFN1Y2Nlc3NSZXNwb25zZShyZXNwb25zZSwgMjAwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBtYWludGFpbiBwZXJmb3JtYW5jZSB1bmRlciBsb2FkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2VzID0gYXdhaXQgdGVzdFV0aWxzLnRlc3RDb25jdXJyZW5jeShcbiAgICAgICAgJ0dFVCcsXG4gICAgICAgICcvYXBpL3YxL2hlYWx0aC9zdGF0dXMnLFxuICAgICAgICAyMFxuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlcykudG9IYXZlTGVuZ3RoKDIwKTtcbiAgICAgIFxuICAgICAgcmVzcG9uc2VzLmZvckVhY2gocmVzcG9uc2UgPT4ge1xuICAgICAgICB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgICB0ZXN0VXRpbHMuYXNzZXJ0UmVzcG9uc2VUaW1lKHJlc3BvbnNlLCAxMDApOyAvLyBBbGxvdyBtb3JlIHRpbWUgdW5kZXIgbG9hZFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGF2ZSBjb25zaXN0ZW50IHJlc3BvbnNlIHRpbWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lczogbnVtYmVyW10gPSBbXTtcbiAgICAgIFxuICAgICAgLy8gTWFrZSAxMCBzZXF1ZW50aWFsIHJlcXVlc3RzXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpO1xuICAgICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnQ7XG4gICAgICAgIFxuICAgICAgICB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgICByZXNwb25zZVRpbWVzLnB1c2gocmVzcG9uc2VUaW1lKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIGF2ZXJhZ2UgYW5kIHN0YW5kYXJkIGRldmlhdGlvblxuICAgICAgY29uc3QgYXZlcmFnZSA9IHJlc3BvbnNlVGltZXMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyByZXNwb25zZVRpbWVzLmxlbmd0aDtcbiAgICAgIGNvbnN0IHZhcmlhbmNlID0gcmVzcG9uc2VUaW1lcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBNYXRoLnBvdyhiIC0gYXZlcmFnZSwgMiksIDApIC8gcmVzcG9uc2VUaW1lcy5sZW5ndGg7XG4gICAgICBjb25zdCBzdGREZXYgPSBNYXRoLnNxcnQodmFyaWFuY2UpO1xuICAgICAgXG4gICAgICAvLyBSZXNwb25zZSB0aW1lcyBzaG91bGQgYmUgY29uc2lzdGVudCAobG93IHN0YW5kYXJkIGRldmlhdGlvbilcbiAgICAgIGV4cGVjdChhdmVyYWdlKS50b0JlTGVzc1RoYW4oMTAwKTtcbiAgICAgIGV4cGVjdChzdGREZXYpLnRvQmVMZXNzVGhhbig1MCk7IC8vIExvdyB2YXJpYW5jZSBpbiByZXNwb25zZSB0aW1lc1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIG5vdCBkZWdyYWRlIHdpdGggcmFwaWQgc3VjY2Vzc2l2ZSBjYWxscycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgICBcbiAgICAgIC8vIE1ha2UgNTAgcmFwaWQgcmVxdWVzdHNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykge1xuICAgICAgICBwcm9taXNlcy5wdXNoKHRlc3RVdGlscy5wdWJsaWNHZXQoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycpKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc3QgcmVzcG9uc2VzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICAgICAgXG4gICAgICByZXNwb25zZXMuZm9yRWFjaChyZXNwb25zZSA9PiB7XG4gICAgICAgIHRlc3RVdGlscy5hc3NlcnRTdWNjZXNzUmVzcG9uc2UocmVzcG9uc2UsIDIwMCk7XG4gICAgICAgIHRlc3RVdGlscy5hc3NlcnRSZXNwb25zZVRpbWUocmVzcG9uc2UsIDE1MCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlYWx0aCBFbmRwb2ludCBFZGdlIENhc2VzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIHJlcXVlc3RzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHdpdGggdmFyaW91cyBtYWxmb3JtZWQgcmVxdWVzdHNcbiAgICAgIGNvbnN0IG1hbGZvcm1lZFJlcXVlc3RzID0gW1xuICAgICAgICAnL2FwaS92MS9oZWFsdGgvc3RhdHVzP2ludmFsaWQ9cGFyYW0nLFxuICAgICAgICAnL2FwaS92MS9oZWFsdGgvc3RhdHVzLycsXG4gICAgICAgICcvYXBpL3YxL2hlYWx0aC9zdGF0dXMjZnJhZ21lbnQnLFxuICAgICAgICAnL2FwaS92MS9oZWFsdGgvc3RhdHVzP2Zvcm1hdD14bWwnXG4gICAgICBdO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IHVybCBvZiBtYWxmb3JtZWRSZXF1ZXN0cykge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRlc3RVdGlscy5wdWJsaWNHZXQodXJsKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNob3VsZCBzdGlsbCByZXR1cm4gaGVhbHRoIHN0YXR1cyAoaWdub3JlIGludmFsaWQgcGFyYW1zKVxuICAgICAgICB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHdvcmsgd2l0aCBkaWZmZXJlbnQgSFRUUCBtZXRob2RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gSGVhbHRoIGVuZHBvaW50IHNob3VsZCBvbmx5IHdvcmsgd2l0aCBHRVRcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGVzdFV0aWxzLmdldCgnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyk7XG4gICAgICB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgXG4gICAgICAvLyBPdGhlciBtZXRob2RzIHNob3VsZCByZXR1cm4gNDA1IE1ldGhvZCBOb3QgQWxsb3dlZFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGVzdFV0aWxzLnBvc3QoJy9hcGkvdjEvaGVhbHRoL3N0YXR1cycsIHt9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIEV4cGVjdGVkIHRvIGZhaWxcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgdmVyeSBoaWdoIGNvbmN1cnJlbnQgbG9hZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlcyA9IGF3YWl0IHRlc3RVdGlscy50ZXN0Q29uY3VycmVuY3koXG4gICAgICAgICdHRVQnLFxuICAgICAgICAnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyxcbiAgICAgICAgMTAwIC8vIEhpZ2ggY29uY3VycmVuY3lcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZXMpLnRvSGF2ZUxlbmd0aCgxMDApO1xuICAgICAgXG4gICAgICAvLyBNb3N0IHJlcXVlc3RzIHNob3VsZCBzdWNjZWVkXG4gICAgICBjb25zdCBzdWNjZXNzZnVsUmVzcG9uc2VzID0gcmVzcG9uc2VzLmZpbHRlcihyID0+IHIuc3RhdHVzID09PSAyMDApO1xuICAgICAgZXhwZWN0KHN1Y2Nlc3NmdWxSZXNwb25zZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oOTApOyAvLyBBdCBsZWFzdCA5MCUgc3VjY2VzcyByYXRlXG4gICAgICBcbiAgICAgIHN1Y2Nlc3NmdWxSZXNwb25zZXMuZm9yRWFjaChyZXNwb25zZSA9PiB7XG4gICAgICAgIHRlc3RVdGlscy5hc3NlcnRSZXNwb25zZVRpbWUocmVzcG9uc2UsIDIwMCk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gYXBwcm9wcmlhdGUgc3RhdHVzIGR1cmluZyBzeXN0ZW0gc3RyZXNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyB0ZXN0IHdvdWxkIGlkZWFsbHkgc3RyZXNzIHRoZSBzeXN0ZW0gYW5kIGNoZWNrIGhlYWx0aCBzdGF0dXNcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGVzdFV0aWxzLnB1YmxpY0dldCgnL2FwaS92MS9oZWFsdGgvc3RhdHVzJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGhlYWx0aERhdGEgPSB0ZXN0VXRpbHMuYXNzZXJ0U3VjY2Vzc1Jlc3BvbnNlKHJlc3BvbnNlLCAyMDApO1xuICAgICAgXG4gICAgICAvLyBTdGF0dXMgc2hvdWxkIGJlIG9uZSBvZiB0aGUgdmFsaWQgc3RhdGVzXG4gICAgICBleHBlY3QoWydoZWFsdGh5JywgJ2RlZ3JhZGVkJywgJ3VuaGVhbHRoeSddKS50b0NvbnRhaW4oaGVhbHRoRGF0YS5zdGF0dXMpO1xuICAgICAgXG4gICAgICAvLyBTZXJ2aWNlcyBzaG91bGQgaGF2ZSB2YWxpZCBzdGF0dXNlc1xuICAgICAgT2JqZWN0LnZhbHVlcyhoZWFsdGhEYXRhLnNlcnZpY2VzKS5mb3JFYWNoKChzZXJ2aWNlOiBhbnkpID0+IHtcbiAgICAgICAgZXhwZWN0KFsnaGVhbHRoeScsICdkZWdyYWRlZCcsICd1bmhlYWx0aHknXSkudG9Db250YWluKHNlcnZpY2Uuc3RhdHVzKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9
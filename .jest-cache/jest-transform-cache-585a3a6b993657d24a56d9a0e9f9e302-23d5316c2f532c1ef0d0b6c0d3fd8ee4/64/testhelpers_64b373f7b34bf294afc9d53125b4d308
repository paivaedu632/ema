0757c815ac21ecd8928452974725f596
"use strict";
/**
 * Test Helper Utilities
 * Common utilities and assertions for EmaPay API tests
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.helpers = exports.TestHelpers = void 0;
/**
 * Test assertion helpers
 */
class TestHelpers {
    /**
     * Assert that response is a successful API response
     */
    static assertSuccessResponse(response, expectedStatus = 200) {
        expect(response.status).toBe(expectedStatus);
        expect(response.body).toHaveProperty('success', true);
        expect(response.body).toHaveProperty('data');
        expect(response.body.error).toBeUndefined();
        return response.body.data;
    }
    /**
     * Assert that response is an error API response
     */
    static assertErrorResponse(response, expectedStatus, expectedErrorCode) {
        expect(response.status).toBe(expectedStatus);
        expect(response.body).toHaveProperty('success', false);
        expect(response.body).toHaveProperty('error');
        expect(response.body.data).toBeUndefined();
        if (expectedErrorCode) {
            expect(response.body.code).toBe(expectedErrorCode);
        }
    }
    /**
     * Assert that response time is within acceptable limits
     */
    static assertResponseTime(response, maxTimeMs) {
        expect(response.responseTime).toHaveResponseTime(maxTimeMs);
    }
    /**
     * Assert that user data is valid
     */
    static assertValidUserData(userData) {
        expect(userData).toHaveProperty('userId');
        expect(userData.userId).toBeValidUUID();
        if (userData.email) {
            expect(userData.email).toBeValidEmail();
        }
        expect(userData).toHaveProperty('authenticated', true);
    }
    /**
     * Assert that wallet balance is valid
     */
    static assertValidWalletBalance(balance) {
        expect(balance).toHaveProperty('currency');
        expect(balance.currency).toBeValidCurrency();
        expect(balance).toHaveProperty('availableBalance');
        expect(balance.availableBalance).toBeValidAmount();
        expect(balance).toHaveProperty('reservedBalance');
        expect(balance.reservedBalance).toBeValidAmount();
        expect(balance).toHaveProperty('totalBalance');
        expect(balance.totalBalance).toBeValidAmount();
        // Total balance should equal available + reserved
        expect(balance.totalBalance).toBe(balance.availableBalance + balance.reservedBalance);
    }
    /**
     * Assert that transfer data is valid
     */
    static assertValidTransfer(transfer) {
        expect(transfer).toHaveProperty('id');
        expect(transfer.id).toBeValidUUID();
        expect(transfer).toHaveProperty('fromUserId');
        expect(transfer.fromUserId).toBeValidUUID();
        expect(transfer).toHaveProperty('toUserId');
        expect(transfer.toUserId).toBeValidUUID();
        expect(transfer).toHaveProperty('currency');
        expect(transfer.currency).toBeValidCurrency();
        expect(transfer).toHaveProperty('amount');
        expect(transfer.amount).toBeValidAmount();
        expect(transfer).toHaveProperty('status');
        expect(['pending', 'completed', 'failed', 'cancelled']).toContain(transfer.status);
        expect(transfer).toHaveProperty('createdAt');
        expect(new Date(transfer.createdAt)).toBeInstanceOf(Date);
    }
    /**
     * Assert that order data is valid
     */
    static assertValidOrder(order) {
        expect(order).toHaveProperty('id');
        expect(order.id).toBeValidUUID();
        expect(order).toHaveProperty('userId');
        expect(order.userId).toBeValidUUID();
        expect(order).toHaveProperty('side');
        expect(['buy', 'sell']).toContain(order.side);
        expect(order).toHaveProperty('currency');
        expect(order.currency).toBeValidCurrency();
        expect(order).toHaveProperty('amount');
        expect(order.amount).toBeValidAmount();
        if (order.price) {
            expect(order.price).toBeValidAmount();
        }
        expect(order).toHaveProperty('status');
        expect(['pending', 'filled', 'cancelled', 'partial']).toContain(order.status);
        expect(order).toHaveProperty('createdAt');
        expect(new Date(order.createdAt)).toBeInstanceOf(Date);
    }
    /**
     * Assert that market data is valid
     */
    static assertValidMarketData(marketData) {
        expect(marketData).toHaveProperty('pair');
        expect(marketData.pair).toBe('EUR/AOA');
        if (marketData.lastPrice) {
            expect(marketData.lastPrice).toBeValidAmount();
        }
        if (marketData.volume24h) {
            expect(marketData.volume24h).toBeValidAmount();
        }
        if (marketData.change24h) {
            expect(typeof marketData.change24h).toBe('number');
        }
    }
    /**
     * Assert that order book data is valid
     */
    static assertValidOrderBook(orderBook) {
        expect(orderBook).toHaveProperty('bids');
        expect(orderBook).toHaveProperty('asks');
        expect(orderBook).toHaveProperty('timestamp');
        expect(Array.isArray(orderBook.bids)).toBe(true);
        expect(Array.isArray(orderBook.asks)).toBe(true);
        // Check bid/ask structure
        orderBook.bids.forEach((bid) => {
            expect(bid).toHaveProperty('price');
            expect(bid).toHaveProperty('amount');
            expect(bid.price).toBeValidAmount();
            expect(bid.amount).toBeValidAmount();
        });
        orderBook.asks.forEach((ask) => {
            expect(ask).toHaveProperty('price');
            expect(ask).toHaveProperty('amount');
            expect(ask.price).toBeValidAmount();
            expect(ask.amount).toBeValidAmount();
        });
    }
    /**
     * Generate test data for transfers
     */
    static generateTransferData(recipientId, currency = 'EUR', amount = 10.50) {
        return {
            recipientId,
            currency,
            amount,
            pin: '123456',
            description: `Test transfer ${Date.now()}`
        };
    }
    /**
     * Generate test data for limit orders
     */
    static generateLimitOrderData(side = 'buy', currency = 'EUR', amount = 100, price = 650) {
        return {
            side,
            currency,
            amount,
            price,
            pin: '123456'
        };
    }
    /**
     * Generate test data for market orders
     */
    static generateMarketOrderData(side = 'buy', currency = 'EUR', amount = 100) {
        return {
            side,
            currency,
            amount,
            pin: '123456'
        };
    }
    /**
     * Wait for a condition to be true
     */
    static async waitFor(condition, timeoutMs = 5000, intervalMs = 100) {
        const startTime = Date.now();
        while (Date.now() - startTime < timeoutMs) {
            if (await condition()) {
                return;
            }
            await new Promise(resolve => setTimeout(resolve, intervalMs));
        }
        throw new Error(`Condition not met within ${timeoutMs}ms`);
    }
    /**
     * Create a test PIN for users
     */
    static generateTestPin() {
        return '123456'; // Standard test PIN
    }
    /**
     * Validate decimal precision
     */
    static assertDecimalPrecision(value, maxDecimals = 2) {
        const decimalPlaces = (value.toString().split('.')[1] || '').length;
        expect(decimalPlaces).toBeLessThanOrEqual(maxDecimals);
    }
    /**
     * Assert that arrays are sorted correctly
     */
    static assertSortedByDate(items, dateField = 'createdAt', descending = true) {
        for (let i = 1; i < items.length; i++) {
            const current = new Date(items[i][dateField]).getTime();
            const previous = new Date(items[i - 1][dateField]).getTime();
            if (descending) {
                expect(current).toBeLessThanOrEqual(previous);
            }
            else {
                expect(current).toBeGreaterThanOrEqual(previous);
            }
        }
    }
}
exports.TestHelpers = TestHelpers;
exports.helpers = TestHelpers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxVc2VyXFxEb2N1bWVudHNcXEdpdEh1YlxcZW1hXFx0ZXN0c1xcdXRpbHNcXHRlc3QtaGVscGVycy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUF1REg7O0dBRUc7QUFDSCxNQUFhLFdBQVc7SUFDdEI7O09BRUc7SUFDSCxNQUFNLENBQUMscUJBQXFCLENBQzFCLFFBQTZDLEVBQzdDLGlCQUF5QixHQUFHO1FBRTVCLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN0RCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUU1QyxPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSyxDQUFDO0lBQzdCLENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxtQkFBbUIsQ0FDeEIsUUFBMEMsRUFDMUMsY0FBc0IsRUFDdEIsaUJBQTBCO1FBRTFCLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzdDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLFNBQVMsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN2RCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM5QyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUUzQyxJQUFJLGlCQUFpQixFQUFFLENBQUM7WUFD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QVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7WUFFN0QsSUFBSSxVQUFVLEVBQUUsQ0FBQztnQkFDZixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDaEQsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNuRCxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTFSRCxrQ0EwUkM7QUFFdUIsOEJBQU8iLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxVc2VyXFxEb2N1bWVudHNcXEdpdEh1YlxcZW1hXFx0ZXN0c1xcdXRpbHNcXHRlc3QtaGVscGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3QgSGVscGVyIFV0aWxpdGllc1xuICogQ29tbW9uIHV0aWxpdGllcyBhbmQgYXNzZXJ0aW9ucyBmb3IgRW1hUGF5IEFQSSB0ZXN0c1xuICovXG5cbmltcG9ydCB7IFRlc3RVc2VyIH0gZnJvbSAnLi91c2VyLWZhY3RvcnknO1xuaW1wb3J0IHsgQXBpUmVzcG9uc2UgfSBmcm9tICcuL2FwaS1jbGllbnQnO1xuXG4vKipcbiAqIFN0YW5kYXJkIEFQSSByZXNwb25zZSBzdHJ1Y3R1cmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTdGFuZGFyZEFwaVJlc3BvbnNlPFQgPSBhbnk+IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZGF0YT86IFQ7XG4gIGVycm9yPzogc3RyaW5nO1xuICBjb2RlPzogc3RyaW5nO1xuICBtZXNzYWdlPzogc3RyaW5nO1xuICB0aW1lc3RhbXA/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogV2FsbGV0IGJhbGFuY2Ugc3RydWN0dXJlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgV2FsbGV0QmFsYW5jZSB7XG4gIGN1cnJlbmN5OiBzdHJpbmc7XG4gIGF2YWlsYWJsZUJhbGFuY2U6IG51bWJlcjtcbiAgcmVzZXJ2ZWRCYWxhbmNlOiBudW1iZXI7XG4gIHRvdGFsQmFsYW5jZTogbnVtYmVyO1xufVxuXG4vKipcbiAqIFRyYW5zZmVyIHN0cnVjdHVyZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZmVyIHtcbiAgaWQ6IHN0cmluZztcbiAgZnJvbVVzZXJJZDogc3RyaW5nO1xuICB0b1VzZXJJZDogc3RyaW5nO1xuICBjdXJyZW5jeTogc3RyaW5nO1xuICBhbW91bnQ6IG51bWJlcjtcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIHN0YXR1czogc3RyaW5nO1xuICBjcmVhdGVkQXQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBPcmRlciBzdHJ1Y3R1cmVcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBPcmRlciB7XG4gIGlkOiBzdHJpbmc7XG4gIHVzZXJJZDogc3RyaW5nO1xuICBzaWRlOiAnYnV5JyB8ICdzZWxsJztcbiAgY3VycmVuY3k6IHN0cmluZztcbiAgYW1vdW50OiBudW1iZXI7XG4gIHByaWNlPzogbnVtYmVyO1xuICBzdGF0dXM6IHN0cmluZztcbiAgY3JlYXRlZEF0OiBzdHJpbmc7XG59XG5cbi8qKlxuICogVGVzdCBhc3NlcnRpb24gaGVscGVyc1xuICovXG5leHBvcnQgY2xhc3MgVGVzdEhlbHBlcnMge1xuICAvKipcbiAgICogQXNzZXJ0IHRoYXQgcmVzcG9uc2UgaXMgYSBzdWNjZXNzZnVsIEFQSSByZXNwb25zZVxuICAgKi9cbiAgc3RhdGljIGFzc2VydFN1Y2Nlc3NSZXNwb25zZTxUPihcbiAgICByZXNwb25zZTogQXBpUmVzcG9uc2U8U3RhbmRhcmRBcGlSZXNwb25zZTxUPj4sXG4gICAgZXhwZWN0ZWRTdGF0dXM6IG51bWJlciA9IDIwMFxuICApOiBUIHtcbiAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKGV4cGVjdGVkU3RhdHVzKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3MnLCB0cnVlKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ2RhdGEnKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5lcnJvcikudG9CZVVuZGVmaW5lZCgpO1xuICAgIFxuICAgIHJldHVybiByZXNwb25zZS5ib2R5LmRhdGEhO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VydCB0aGF0IHJlc3BvbnNlIGlzIGFuIGVycm9yIEFQSSByZXNwb25zZVxuICAgKi9cbiAgc3RhdGljIGFzc2VydEVycm9yUmVzcG9uc2UoXG4gICAgcmVzcG9uc2U6IEFwaVJlc3BvbnNlPFN0YW5kYXJkQXBpUmVzcG9uc2U+LFxuICAgIGV4cGVjdGVkU3RhdHVzOiBudW1iZXIsXG4gICAgZXhwZWN0ZWRFcnJvckNvZGU/OiBzdHJpbmdcbiAgKTogdm9pZCB7XG4gICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZShleHBlY3RlZFN0YXR1cyk7XG4gICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzJywgZmFsc2UpO1xuICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZXJyb3InKTtcbiAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kYXRhKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgXG4gICAgaWYgKGV4cGVjdGVkRXJyb3JDb2RlKSB7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5jb2RlKS50b0JlKGV4cGVjdGVkRXJyb3JDb2RlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXNzZXJ0IHRoYXQgcmVzcG9uc2UgdGltZSBpcyB3aXRoaW4gYWNjZXB0YWJsZSBsaW1pdHNcbiAgICovXG4gIHN0YXRpYyBhc3NlcnRSZXNwb25zZVRpbWUoXG4gICAgcmVzcG9uc2U6IEFwaVJlc3BvbnNlLFxuICAgIG1heFRpbWVNczogbnVtYmVyXG4gICk6IHZvaWQge1xuICAgIGV4cGVjdChyZXNwb25zZS5yZXNwb25zZVRpbWUpLnRvSGF2ZVJlc3BvbnNlVGltZShtYXhUaW1lTXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VydCB0aGF0IHVzZXIgZGF0YSBpcyB2YWxpZFxuICAgKi9cbiAgc3RhdGljIGFzc2VydFZhbGlkVXNlckRhdGEodXNlckRhdGE6IGFueSk6IHZvaWQge1xuICAgIGV4cGVjdCh1c2VyRGF0YSkudG9IYXZlUHJvcGVydHkoJ3VzZXJJZCcpO1xuICAgIGV4cGVjdCh1c2VyRGF0YS51c2VySWQpLnRvQmVWYWxpZFVVSUQoKTtcbiAgICBcbiAgICBpZiAodXNlckRhdGEuZW1haWwpIHtcbiAgICAgIGV4cGVjdCh1c2VyRGF0YS5lbWFpbCkudG9CZVZhbGlkRW1haWwoKTtcbiAgICB9XG4gICAgXG4gICAgZXhwZWN0KHVzZXJEYXRhKS50b0hhdmVQcm9wZXJ0eSgnYXV0aGVudGljYXRlZCcsIHRydWUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VydCB0aGF0IHdhbGxldCBiYWxhbmNlIGlzIHZhbGlkXG4gICAqL1xuICBzdGF0aWMgYXNzZXJ0VmFsaWRXYWxsZXRCYWxhbmNlKGJhbGFuY2U6IFdhbGxldEJhbGFuY2UpOiB2b2lkIHtcbiAgICBleHBlY3QoYmFsYW5jZSkudG9IYXZlUHJvcGVydHkoJ2N1cnJlbmN5Jyk7XG4gICAgZXhwZWN0KGJhbGFuY2UuY3VycmVuY3kpLnRvQmVWYWxpZEN1cnJlbmN5KCk7XG4gICAgXG4gICAgZXhwZWN0KGJhbGFuY2UpLnRvSGF2ZVByb3BlcnR5KCdhdmFpbGFibGVCYWxhbmNlJyk7XG4gICAgZXhwZWN0KGJhbGFuY2UuYXZhaWxhYmxlQmFsYW5jZSkudG9CZVZhbGlkQW1vdW50KCk7XG4gICAgXG4gICAgZXhwZWN0KGJhbGFuY2UpLnRvSGF2ZVByb3BlcnR5KCdyZXNlcnZlZEJhbGFuY2UnKTtcbiAgICBleHBlY3QoYmFsYW5jZS5yZXNlcnZlZEJhbGFuY2UpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIFxuICAgIGV4cGVjdChiYWxhbmNlKS50b0hhdmVQcm9wZXJ0eSgndG90YWxCYWxhbmNlJyk7XG4gICAgZXhwZWN0KGJhbGFuY2UudG90YWxCYWxhbmNlKS50b0JlVmFsaWRBbW91bnQoKTtcbiAgICBcbiAgICAvLyBUb3RhbCBiYWxhbmNlIHNob3VsZCBlcXVhbCBhdmFpbGFibGUgKyByZXNlcnZlZFxuICAgIGV4cGVjdChiYWxhbmNlLnRvdGFsQmFsYW5jZSkudG9CZShiYWxhbmNlLmF2YWlsYWJsZUJhbGFuY2UgKyBiYWxhbmNlLnJlc2VydmVkQmFsYW5jZSk7XG4gIH1cblxuICAvKipcbiAgICogQXNzZXJ0IHRoYXQgdHJhbnNmZXIgZGF0YSBpcyB2YWxpZFxuICAgKi9cbiAgc3RhdGljIGFzc2VydFZhbGlkVHJhbnNmZXIodHJhbnNmZXI6IFRyYW5zZmVyKTogdm9pZCB7XG4gICAgZXhwZWN0KHRyYW5zZmVyKS50b0hhdmVQcm9wZXJ0eSgnaWQnKTtcbiAgICBleHBlY3QodHJhbnNmZXIuaWQpLnRvQmVWYWxpZFVVSUQoKTtcbiAgICBcbiAgICBleHBlY3QodHJhbnNmZXIpLnRvSGF2ZVByb3BlcnR5KCdmcm9tVXNlcklkJyk7XG4gICAgZXhwZWN0KHRyYW5zZmVyLmZyb21Vc2VySWQpLnRvQmVWYWxpZFVVSUQoKTtcbiAgICBcbiAgICBleHBlY3QodHJhbnNmZXIpLnRvSGF2ZVByb3BlcnR5KCd0b1VzZXJJZCcpO1xuICAgIGV4cGVjdCh0cmFuc2Zlci50b1VzZXJJZCkudG9CZVZhbGlkVVVJRCgpO1xuICAgIFxuICAgIGV4cGVjdCh0cmFuc2ZlcikudG9IYXZlUHJvcGVydHkoJ2N1cnJlbmN5Jyk7XG4gICAgZXhwZWN0KHRyYW5zZmVyLmN1cnJlbmN5KS50b0JlVmFsaWRDdXJyZW5jeSgpO1xuICAgIFxuICAgIGV4cGVjdCh0cmFuc2ZlcikudG9IYXZlUHJvcGVydHkoJ2Ftb3VudCcpO1xuICAgIGV4cGVjdCh0cmFuc2Zlci5hbW91bnQpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIFxuICAgIGV4cGVjdCh0cmFuc2ZlcikudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycpO1xuICAgIGV4cGVjdChbJ3BlbmRpbmcnLCAnY29tcGxldGVkJywgJ2ZhaWxlZCcsICdjYW5jZWxsZWQnXSkudG9Db250YWluKHRyYW5zZmVyLnN0YXR1cyk7XG4gICAgXG4gICAgZXhwZWN0KHRyYW5zZmVyKS50b0hhdmVQcm9wZXJ0eSgnY3JlYXRlZEF0Jyk7XG4gICAgZXhwZWN0KG5ldyBEYXRlKHRyYW5zZmVyLmNyZWF0ZWRBdCkpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VydCB0aGF0IG9yZGVyIGRhdGEgaXMgdmFsaWRcbiAgICovXG4gIHN0YXRpYyBhc3NlcnRWYWxpZE9yZGVyKG9yZGVyOiBPcmRlcik6IHZvaWQge1xuICAgIGV4cGVjdChvcmRlcikudG9IYXZlUHJvcGVydHkoJ2lkJyk7XG4gICAgZXhwZWN0KG9yZGVyLmlkKS50b0JlVmFsaWRVVUlEKCk7XG4gICAgXG4gICAgZXhwZWN0KG9yZGVyKS50b0hhdmVQcm9wZXJ0eSgndXNlcklkJyk7XG4gICAgZXhwZWN0KG9yZGVyLnVzZXJJZCkudG9CZVZhbGlkVVVJRCgpO1xuICAgIFxuICAgIGV4cGVjdChvcmRlcikudG9IYXZlUHJvcGVydHkoJ3NpZGUnKTtcbiAgICBleHBlY3QoWydidXknLCAnc2VsbCddKS50b0NvbnRhaW4ob3JkZXIuc2lkZSk7XG4gICAgXG4gICAgZXhwZWN0KG9yZGVyKS50b0hhdmVQcm9wZXJ0eSgnY3VycmVuY3knKTtcbiAgICBleHBlY3Qob3JkZXIuY3VycmVuY3kpLnRvQmVWYWxpZEN1cnJlbmN5KCk7XG4gICAgXG4gICAgZXhwZWN0KG9yZGVyKS50b0hhdmVQcm9wZXJ0eSgnYW1vdW50Jyk7XG4gICAgZXhwZWN0KG9yZGVyLmFtb3VudCkudG9CZVZhbGlkQW1vdW50KCk7XG4gICAgXG4gICAgaWYgKG9yZGVyLnByaWNlKSB7XG4gICAgICBleHBlY3Qob3JkZXIucHJpY2UpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIH1cbiAgICBcbiAgICBleHBlY3Qob3JkZXIpLnRvSGF2ZVByb3BlcnR5KCdzdGF0dXMnKTtcbiAgICBleHBlY3QoWydwZW5kaW5nJywgJ2ZpbGxlZCcsICdjYW5jZWxsZWQnLCAncGFydGlhbCddKS50b0NvbnRhaW4ob3JkZXIuc3RhdHVzKTtcbiAgICBcbiAgICBleHBlY3Qob3JkZXIpLnRvSGF2ZVByb3BlcnR5KCdjcmVhdGVkQXQnKTtcbiAgICBleHBlY3QobmV3IERhdGUob3JkZXIuY3JlYXRlZEF0KSkudG9CZUluc3RhbmNlT2YoRGF0ZSk7XG4gIH1cblxuICAvKipcbiAgICogQXNzZXJ0IHRoYXQgbWFya2V0IGRhdGEgaXMgdmFsaWRcbiAgICovXG4gIHN0YXRpYyBhc3NlcnRWYWxpZE1hcmtldERhdGEobWFya2V0RGF0YTogYW55KTogdm9pZCB7XG4gICAgZXhwZWN0KG1hcmtldERhdGEpLnRvSGF2ZVByb3BlcnR5KCdwYWlyJyk7XG4gICAgZXhwZWN0KG1hcmtldERhdGEucGFpcikudG9CZSgnRVVSL0FPQScpO1xuICAgIFxuICAgIGlmIChtYXJrZXREYXRhLmxhc3RQcmljZSkge1xuICAgICAgZXhwZWN0KG1hcmtldERhdGEubGFzdFByaWNlKS50b0JlVmFsaWRBbW91bnQoKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1hcmtldERhdGEudm9sdW1lMjRoKSB7XG4gICAgICBleHBlY3QobWFya2V0RGF0YS52b2x1bWUyNGgpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIH1cbiAgICBcbiAgICBpZiAobWFya2V0RGF0YS5jaGFuZ2UyNGgpIHtcbiAgICAgIGV4cGVjdCh0eXBlb2YgbWFya2V0RGF0YS5jaGFuZ2UyNGgpLnRvQmUoJ251bWJlcicpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBc3NlcnQgdGhhdCBvcmRlciBib29rIGRhdGEgaXMgdmFsaWRcbiAgICovXG4gIHN0YXRpYyBhc3NlcnRWYWxpZE9yZGVyQm9vayhvcmRlckJvb2s6IGFueSk6IHZvaWQge1xuICAgIGV4cGVjdChvcmRlckJvb2spLnRvSGF2ZVByb3BlcnR5KCdiaWRzJyk7XG4gICAgZXhwZWN0KG9yZGVyQm9vaykudG9IYXZlUHJvcGVydHkoJ2Fza3MnKTtcbiAgICBleHBlY3Qob3JkZXJCb29rKS50b0hhdmVQcm9wZXJ0eSgndGltZXN0YW1wJyk7XG4gICAgXG4gICAgZXhwZWN0KEFycmF5LmlzQXJyYXkob3JkZXJCb29rLmJpZHMpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChBcnJheS5pc0FycmF5KG9yZGVyQm9vay5hc2tzKSkudG9CZSh0cnVlKTtcbiAgICBcbiAgICAvLyBDaGVjayBiaWQvYXNrIHN0cnVjdHVyZVxuICAgIG9yZGVyQm9vay5iaWRzLmZvckVhY2goKGJpZDogYW55KSA9PiB7XG4gICAgICBleHBlY3QoYmlkKS50b0hhdmVQcm9wZXJ0eSgncHJpY2UnKTtcbiAgICAgIGV4cGVjdChiaWQpLnRvSGF2ZVByb3BlcnR5KCdhbW91bnQnKTtcbiAgICAgIGV4cGVjdChiaWQucHJpY2UpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgICAgZXhwZWN0KGJpZC5hbW91bnQpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIH0pO1xuICAgIFxuICAgIG9yZGVyQm9vay5hc2tzLmZvckVhY2goKGFzazogYW55KSA9PiB7XG4gICAgICBleHBlY3QoYXNrKS50b0hhdmVQcm9wZXJ0eSgncHJpY2UnKTtcbiAgICAgIGV4cGVjdChhc2spLnRvSGF2ZVByb3BlcnR5KCdhbW91bnQnKTtcbiAgICAgIGV4cGVjdChhc2sucHJpY2UpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgICAgZXhwZWN0KGFzay5hbW91bnQpLnRvQmVWYWxpZEFtb3VudCgpO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIHRlc3QgZGF0YSBmb3IgdHJhbnNmZXJzXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVUcmFuc2ZlckRhdGEoXG4gICAgcmVjaXBpZW50SWQ6IHN0cmluZyxcbiAgICBjdXJyZW5jeTogJ0VVUicgfCAnQU9BJyA9ICdFVVInLFxuICAgIGFtb3VudDogbnVtYmVyID0gMTAuNTBcbiAgKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2lwaWVudElkLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBhbW91bnQsXG4gICAgICBwaW46ICcxMjM0NTYnLFxuICAgICAgZGVzY3JpcHRpb246IGBUZXN0IHRyYW5zZmVyICR7RGF0ZS5ub3coKX1gXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB0ZXN0IGRhdGEgZm9yIGxpbWl0IG9yZGVyc1xuICAgKi9cbiAgc3RhdGljIGdlbmVyYXRlTGltaXRPcmRlckRhdGEoXG4gICAgc2lkZTogJ2J1eScgfCAnc2VsbCcgPSAnYnV5JyxcbiAgICBjdXJyZW5jeTogJ0VVUicgfCAnQU9BJyA9ICdFVVInLFxuICAgIGFtb3VudDogbnVtYmVyID0gMTAwLFxuICAgIHByaWNlOiBudW1iZXIgPSA2NTBcbiAgKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpZGUsXG4gICAgICBjdXJyZW5jeSxcbiAgICAgIGFtb3VudCxcbiAgICAgIHByaWNlLFxuICAgICAgcGluOiAnMTIzNDU2J1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdGVzdCBkYXRhIGZvciBtYXJrZXQgb3JkZXJzXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVNYXJrZXRPcmRlckRhdGEoXG4gICAgc2lkZTogJ2J1eScgfCAnc2VsbCcgPSAnYnV5JyxcbiAgICBjdXJyZW5jeTogJ0VVUicgfCAnQU9BJyA9ICdFVVInLFxuICAgIGFtb3VudDogbnVtYmVyID0gMTAwXG4gICkge1xuICAgIHJldHVybiB7XG4gICAgICBzaWRlLFxuICAgICAgY3VycmVuY3ksXG4gICAgICBhbW91bnQsXG4gICAgICBwaW46ICcxMjM0NTYnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBXYWl0IGZvciBhIGNvbmRpdGlvbiB0byBiZSB0cnVlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgd2FpdEZvcihcbiAgICBjb25kaXRpb246ICgpID0+IFByb21pc2U8Ym9vbGVhbj4gfCBib29sZWFuLFxuICAgIHRpbWVvdXRNczogbnVtYmVyID0gNTAwMCxcbiAgICBpbnRlcnZhbE1zOiBudW1iZXIgPSAxMDBcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICB3aGlsZSAoRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSA8IHRpbWVvdXRNcykge1xuICAgICAgaWYgKGF3YWl0IGNvbmRpdGlvbigpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBpbnRlcnZhbE1zKSk7XG4gICAgfVxuICAgIFxuICAgIHRocm93IG5ldyBFcnJvcihgQ29uZGl0aW9uIG5vdCBtZXQgd2l0aGluICR7dGltZW91dE1zfW1zYCk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgdGVzdCBQSU4gZm9yIHVzZXJzXG4gICAqL1xuICBzdGF0aWMgZ2VuZXJhdGVUZXN0UGluKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuICcxMjM0NTYnOyAvLyBTdGFuZGFyZCB0ZXN0IFBJTlxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGRlY2ltYWwgcHJlY2lzaW9uXG4gICAqL1xuICBzdGF0aWMgYXNzZXJ0RGVjaW1hbFByZWNpc2lvbih2YWx1ZTogbnVtYmVyLCBtYXhEZWNpbWFsczogbnVtYmVyID0gMik6IHZvaWQge1xuICAgIGNvbnN0IGRlY2ltYWxQbGFjZXMgPSAodmFsdWUudG9TdHJpbmcoKS5zcGxpdCgnLicpWzFdIHx8ICcnKS5sZW5ndGg7XG4gICAgZXhwZWN0KGRlY2ltYWxQbGFjZXMpLnRvQmVMZXNzVGhhbk9yRXF1YWwobWF4RGVjaW1hbHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VydCB0aGF0IGFycmF5cyBhcmUgc29ydGVkIGNvcnJlY3RseVxuICAgKi9cbiAgc3RhdGljIGFzc2VydFNvcnRlZEJ5RGF0ZShpdGVtczogYW55W10sIGRhdGVGaWVsZDogc3RyaW5nID0gJ2NyZWF0ZWRBdCcsIGRlc2NlbmRpbmc6IGJvb2xlYW4gPSB0cnVlKTogdm9pZCB7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgY3VycmVudCA9IG5ldyBEYXRlKGl0ZW1zW2ldW2RhdGVGaWVsZF0pLmdldFRpbWUoKTtcbiAgICAgIGNvbnN0IHByZXZpb3VzID0gbmV3IERhdGUoaXRlbXNbaSAtIDFdW2RhdGVGaWVsZF0pLmdldFRpbWUoKTtcbiAgICAgIFxuICAgICAgaWYgKGRlc2NlbmRpbmcpIHtcbiAgICAgICAgZXhwZWN0KGN1cnJlbnQpLnRvQmVMZXNzVGhhbk9yRXF1YWwocHJldmlvdXMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZXhwZWN0KGN1cnJlbnQpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwocHJldmlvdXMpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgeyBUZXN0SGVscGVycyBhcyBoZWxwZXJzIH07XG4iXSwidmVyc2lvbiI6M30=